<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AppMakerHarresh</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link as="style" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: 'Space Grotesk', sans-serif; }
.container { max-width: 800px; margin: 4rem auto; padding: 2rem; text-align: center; }
.button { background-color: #141414; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; text-decoration: none; }
</style>
</head>
<body class="bg-gray-100 text-gray-900">
<div class="container">
    <h1 class="text-4xl font-bold mb-4">Welcome to AppMakerHarresh</h1>
    <p class="mb-6">Explore projects and be part of development!</p>

    <!-- GitHub info -->
    <div id="github-info" class="mb-6">
        <p>Loading GitHub info...</p>
    </div>

    <!-- Be a part of development -->
    <a href="https://github.com/appmakerharresh" target="_blank" class="button">Be a part of development</a>
</div>

<script>
// GitHub API fetch
async function loadGitHubInfo() {
    try {
        const response = await fetch('https://api.github.com/users/appmakerharresh/repos');
        const repos = await response.json();
        const infoDiv = document.getElementById('github-info');
        infoDiv.innerHTML = `
            <p>Total public repos: <strong>${repos.length}</strong></p>
            <ul class="list-disc list-inside mt-2">
                ${repos.slice(0,5).map(r => `<li><a href="${r.html_url}" target="_blank">${r.name}</a></li>`).join('')}
            </ul>
        `;
    } catch (err) {
        console.error(err);
        document.getElementById('github-info').textContent = 'Failed to load GitHub info.';
    }
}
loadGitHubInfo();

// Inline Service Worker with URL injection
if ('serviceWorker' in navigator) {
    const swCode = `
        const fallbackURL = '/404/index.html';
        self.addEventListener('install', event => {
            event.waitUntil(
                caches.open('app-cache-v1').then(cache => cache.add(fallbackURL))
            );
            self.skipWaiting();
        });

        self.addEventListener('fetch', event => {
            const url = new URL(event.request.url);
            if (url.origin === location.origin) {
                event.respondWith(
                    fetch(event.request).catch(async () => {
                        const cache = await caches.open('app-cache-v1');
                        const response = await cache.match(fallbackURL);
                        if (!response) return new Response('404 not found', { status: 404 });
                        let html = await response.text();
                        // Inject the attempted URL
                        html = html.replace('window.location.href', JSON.stringify(url.href));
                        return new Response(html, { headers: {'Content-Type': 'text/html'} });
                    })
                );
            }
        });
    `;
    const blob = new Blob([swCode], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl)
        .then(() => console.log('Inline Service Worker registered'))
        .catch(err => console.error('SW registration failed:', err));
}
</script>
</body>
</html>
